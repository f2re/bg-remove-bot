# –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –±–æ—Ç–∞ –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

## üìã –û–ë–©–ê–Ø –û–¶–ï–ù–ö–ê

–ü—Ä–æ–µ–∫—Ç –∏–º–µ–µ—Ç —Ö–æ—Ä–æ—à—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –ø—Ä–æ–¥—É–º–∞–Ω–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, –Ω–æ —Å–æ–¥–µ—Ä–∂–∞–ª **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã**, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–ª–∞–ª–∏ –µ–≥–æ –Ω–µ—Ä–∞–±–æ—á–∏–º.

---

## ‚úÖ –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢ –ü–†–ê–í–ò–õ–¨–ù–û

### 1. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞**
- ‚úÖ –ß–∏—Å—Ç–∞—è –º–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –Ω–∞ handlers, services, database
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ SQLAlchemy 2.0 —Å async –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π –ë–î –∏ CRUD –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ Alembic –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### 2. **–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (app/handlers/support.py)**
- ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢**: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º (—Å—Ç—Ä–æ–∫–∏ 119-124)
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–∫–µ—Ç–æ–≤ –≤ –ë–î
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π (10-1000 —Å–∏–º–≤–æ–ª–æ–≤)
- ‚úÖ FSM –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏

### 3. **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (app/handlers/admin.py)**
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –∏ –æ—Ç–≤–µ—Ç –Ω–∞ –æ–±—Ä–∞—â–µ–Ω–∏—è
- ‚úÖ –†—É—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- ‚úÖ –ó–∞–∫—Ä—ã—Ç–∏–µ —Ç–∏–∫–µ—Ç–æ–≤

### 4. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–ª—è—Ö
- ‚úÖ –ü–æ–¥—Å—á–µ—Ç –±–∞–ª–∞–Ω—Å–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### 5. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –†–æ–±–æ–∫–∞—Å—Å–æ–π**
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–µ–π MD5
- ‚úÖ –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å—Å—ã–ª–æ–∫
- ‚úÖ –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–µ–π

---

## ‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ (–ò–°–ü–†–ê–í–õ–ï–ù–´)

### 1. **OpenRouter API - –ù–ï –†–ê–ë–û–¢–ê–õ–û** üî¥ –ö–†–ò–¢–ò–ß–ù–û

**–§–∞–π–ª**: `app/services/openrouter.py`

#### –ü—Ä–æ–±–ª–µ–º—ã:
- –°—Ç—Ä–æ–∫–∏ 70-76: –í–æ–∑–≤—Ä–∞—â–∞–ª **–æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ** –±–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- API –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è **–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ** - –Ω–µ –±—ã–ª–æ —É–∫–∞–∑–∞–Ω–æ `modalities: ["text", "image"]`
- –ù–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª—Å—è –æ—Ç–≤–µ—Ç –æ—Ç API (–ø–æ–ª–µ `images`)
- –ú–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `nano-banana-ai/model-name` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ base64 –∏ URL —Ñ–æ—Ä–º–∞—Ç–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

#### –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
```python
# –î–û (–Ω–µ —Ä–∞–±–æ—Ç–∞–ª–æ):
return {
    "success": True,
    "image_bytes": image_bytes,  # –í–æ–∑–≤—Ä–∞—â–∞–ª –æ—Ä–∏–≥–∏–Ω–∞–ª!
    "error": None
}

# –ü–û–°–õ–ï (—Ä–∞–±–æ—Ç–∞–µ—Ç):
payload = {
    "model": self.model,
    "modalities": ["text", "image"],  # ‚úÖ –í–∫–ª—é—á–µ–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    "messages": [...]
}

# ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞
images = message.get('images', [])
if images:
    image_data = images[0]
    # –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ base64 –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ URL
    if image_data.startswith('data:'):
        base64_part = image_data.split(',', 1)[1]
        processed_image_bytes = base64.b64decode(base64_part)
```

#### –ò–∑–º–µ–Ω–µ–Ω–∏—è:
1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `modalities: ["text", "image"]`
2. ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ API (–ø–æ–ª—è `images` –∏ `content`)
3. ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ base64 –∏ URL —Ñ–æ—Ä–º–∞—Ç–æ–≤
4. ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∞ –º–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞ `google/gemini-2.5-flash-image-preview`
5. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
6. ‚úÖ –¢–∞–π–º–∞—É—Ç —É–≤–µ–ª–∏—á–µ–Ω –¥–æ 60 —Å–µ–∫—É–Ω–¥

**–õ–æ–∫–∞—Ü–∏—è**: `app/services/openrouter.py:23-168`

---

### 2. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–æ–∫—É–ø–∫–µ - –û–¢–°–£–¢–°–¢–í–û–í–ê–õ–ò** üî¥ –ö–†–ò–¢–ò–ß–ù–û

**–§–∞–π–ª**: `app/handlers/payment.py`

#### –ü—Ä–æ–±–ª–µ–º—ã:
- –°—Ç—Ä–æ–∫–∞ 130: –§—É–Ω–∫—Ü–∏—è `process_payment_webhook` –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —É–∑–Ω–∞–≤–∞–ª –æ–± —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–µ –ø–æ–ª—É—á–∞–ª –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–æ–≤—ã—Ö –ø–æ–∫—É–ø–∫–∞—Ö

#### –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

**–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å**: `app/services/notification_service.py`
- ‚úÖ `notify_user_payment_success()` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- ‚úÖ `notify_admins_new_payment()` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º
- ‚úÖ `notify_user_payment_failed()` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
- ‚úÖ `notify_user_refund()` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≤–æ–∑–≤—Ä–∞—Ç–µ

**–û–±–Ω–æ–≤–ª–µ–Ω**: `app/handlers/payment.py`
```python
# –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è (—Å—Ç—Ä–æ–∫–∞ 130)
async def notify_payment_success(bot, order_id: int):
    # –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞
    # –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    await NotificationService.notify_user_payment_success(...)
    # –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º
    await NotificationService.notify_admins_new_payment(...)
```

**–õ–æ–∫–∞—Ü–∏—è**:
- `app/services/notification_service.py:1-117` (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)
- `app/handlers/payment.py:130-223` (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)

---

### 3. **Webhook –¥–ª—è Robokassa - –û–¢–°–£–¢–°–¢–í–û–í–ê–õ** üî¥ –ö–†–ò–¢–ò–ß–ù–û

#### –ü—Ä–æ–±–ª–µ–º–∞:
- –ù–µ—Ç HTTP endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç –†–æ–±–æ–∫–∞—Å—Å—ã
- –û–ø–ª–∞—Ç—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

#### –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

**–°–æ–∑–¥–∞–Ω**: `app/services/webhook_server.py` - –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π aiohttp —Å–µ—Ä–≤–µ—Ä

Endpoints:
- ‚úÖ `GET/POST /robokassa/result` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ ResultURL
- ‚úÖ `GET /robokassa/success` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å–ø–µ—Ö–∞
- ‚úÖ `GET /robokassa/fail` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—à–∏–±–∫–∏
- ‚úÖ `GET /health` - health check

–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
```python
async def handle_robokassa_result(request: web.Request):
    # 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (OutSum, InvId, SignatureValue)
    # 2. –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏
    # 3. –ü–æ–∏—Å–∫ –∑–∞–∫–∞–∑–∞ –≤ –ë–î
    # 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ 'paid'
    # 5. –í–æ–∑–≤—Ä–∞—Ç "OK{InvId}" (—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –†–æ–±–æ–∫–∞—Å—Å—ã)
```

**–ó–∞–ø—É—Å–∫**:
```bash
python -m app.services.webhook_server
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ Robokassa**:
- ResultURL: `https://your-domain.com/robokassa/result`
- SuccessURL: `https://your-domain.com/robokassa/success`
- FailURL: `https://your-domain.com/robokassa/fail`

**–õ–æ–∫–∞—Ü–∏—è**: `app/services/webhook_server.py:1-151` (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)

---

### 4. **admin_only Decorator - –ö–û–ù–§–õ–ò–ö–¢** ‚ö†Ô∏è –í–ê–ñ–ù–û

**–§–∞–π–ª**: `app/utils/decorators.py`

#### –ü—Ä–æ–±–ª–µ–º–∞:
- –°—Ç—Ä–æ–∫–∏ 29-34: –ü—Ä–æ–≤–µ—Ä—è–ª —Ç–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü—É `admins` –≤ –ë–î
- –ù–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã —Ç–∞–∫–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —á–µ—Ä–µ–∑ `ADMIN_IDS` –≤ `.env`
- –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –Ω–µ —Ä–∞–±–æ—Ç–∞–ª –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞

#### –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
```python
# –î–û (–Ω–µ —Ä–∞–±–æ—Ç–∞–ª–æ):
if await is_admin(session, telegram_id):
    return await func(...)

# –ü–û–°–õ–ï (—Ä–∞–±–æ—Ç–∞–µ—Ç):
is_admin_in_config = telegram_id in settings.admin_ids_list  # ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥–∞
is_admin_in_db = await is_admin(session, telegram_id)         # ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î

if is_admin_in_config or is_admin_in_db:  # ‚úÖ –ò–õ–ò
    return await func(...)
```

**–õ–æ–∫–∞—Ü–∏—è**: `app/utils/decorators.py:10-45`

---

### 5. **–ü—Ä–æ–º–ø—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ñ–æ–Ω–∞ - –ù–ï–î–û–°–¢–ê–¢–û–ß–ù–û –°–ü–ï–¶–ò–§–ò–ß–ù–´–ô** ‚ö†Ô∏è –í–ê–ñ–ù–û

**–§–∞–π–ª**: `app/services/prompt_builder.py`

#### –ü—Ä–æ–±–ª–µ–º–∞:
- –°—Ç—Ä–æ–∫–∏ 8-42: –ü—Ä–æ–º–ø—Ç –±—ã–ª —Å–ª–∏—à–∫–æ–º –æ–±—â–∏–º
- –ù–µ –±—ã–ª–æ —è–≤–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è –Ω–∞ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (alpha channel = 0)
- –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –≤—ã—Ö–æ–¥–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É

#### –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

**–î–û**:
```python
base_prompt = "Remove background completely, "
# ... –∫–æ—Ä–æ—Ç–∫–∏–π –ø—Ä–æ–º–ø—Ç
base_prompt += "maintain natural lighting, clean cutout, high precision"
```

**–ü–û–°–õ–ï**:
```python
base_prompt = (
    "Edit this image: Remove the entire background completely and make it fully transparent. "
    "Keep ONLY the main subject in the foreground. "
)

# + –î–µ—Ç–∞–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –≤–æ–ª–æ—Å, —Å—Ç–µ–∫–ª–∞, —Ä–∞–∑–º—ã—Ç–∏—è, –æ—Å–≤–µ—â–µ–Ω–∏—è

# –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
base_prompt += (
    "Requirements: "
    "1) Background must be 100% transparent (alpha channel = 0). "
    "2) Subject edges must be clean and natural, no pixelation. "
    "3) Preserve all shadows and highlights on the subject itself. "
    "4) Maintain the subject's original colors and lighting. "
    "5) Output as PNG with transparency."
)
```

**–õ–æ–∫–∞—Ü–∏—è**: `app/services/prompt_builder.py:8-67`

---

## üìù –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

### 1. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ OpenRouter**
**–§–∞–π–ª**: `app/config.py`

–û–±–Ω–æ–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:
```python
# –î–û:
OPENROUTER_MODEL: str = "nano-banana-ai/model-name"  # ‚ùå –ù–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

# –ü–û–°–õ–ï:
OPENROUTER_MODEL: str = "google/gemini-2.5-flash-image-preview"  # ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
```

**–õ–æ–∫–∞—Ü–∏—è**: `app/config.py:19-21`

---

## üöÄ –ö–ê–ö –ó–ê–ü–£–°–¢–ò–¢–¨

### 1. –û–±–Ω–æ–≤–∏—Ç–µ .env —Ñ–∞–π–ª:
```env
OPENROUTER_MODEL=google/gemini-2.5-flash-image-preview
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:
```bash
python -m app.bot
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ webhook —Å–µ—Ä–≤–µ—Ä (–≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ):
```bash
python -m app.services.webhook_server
```

### 4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Robokassa:
- ResultURL: `https://your-domain.com/robokassa/result`
- SuccessURL: `https://your-domain.com/robokassa/success`
- FailURL: `https://your-domain.com/robokassa/fail`

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ò–ó–ú–ï–ù–ï–ù–ò–ô

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ | –§–∞–π–ª–æ–≤ —Å–æ–∑–¥–∞–Ω–æ | –°—Ç—Ä–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–æ |
|-----------|----------------|----------------|-----------------|
| Services  | 3              | 2              | ~350            |
| Handlers  | 1              | 0              | ~93             |
| Config    | 1              | 0              | 3               |
| Utils     | 1              | 0              | 14              |
| **–ò–¢–û–ì–û** | **6**          | **2**          | **~460**        |

---

## ‚úÖ –ò–¢–û–ì–û–í–´–ô –ß–ï–ö–õ–ò–°–¢

### –§–ª–æ—É –±–æ—Ç–∞
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ 3 –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (—Ç—Ä–µ–±—É–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º API)
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –±–∞–ª–∞–Ω—Å–∞
- ‚úÖ –ü–æ–∫—É–ø–∫–∞ –ø–∞–∫–µ—Ç–æ–≤

### –ü–ª–∞—Ç–µ–∂–∏
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Å—ã–ª–æ–∫ Robokassa
- ‚úÖ Webhook endpoint –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–ø–ª–∞—Ç
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ–± —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É –æ –Ω–æ–≤–æ–π –ø–æ–∫—É–ø–∫–µ
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### –ü–æ–¥–¥–µ—Ä–∂–∫–∞
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—Ä–∞—â–µ–Ω–∏–π
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º
- ‚úÖ –û—Ç–≤–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –æ–±—Ä–∞—â–µ–Ω–∏–π
- ‚úÖ –û—Ç–≤–µ—Ç –Ω–∞ –æ–±—Ä–∞—â–µ–Ω–∏—è
- ‚úÖ –†—É—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### OpenRouter API
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ modalities
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ API
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ñ–æ–Ω–∞

---

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø

### 1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ OpenRouter API**
–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ OpenRouter 2025. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º–∞—Ç–∞ –æ—Ç–≤–µ—Ç–∞ API
- –ö–∞—á–µ—Å—Ç–≤–æ —É–¥–∞–ª–µ–Ω–∏—è —Ñ–æ–Ω–∞
- –û–±—Ä–∞–±–æ—Ç–∫—É —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

### 2. **Webhook —Å–µ—Ä–≤–µ—Ä**
–ù—É–∂–Ω–æ:
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å reverse proxy (nginx)
- –î–æ–±–∞–≤–∏—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (Let's Encrypt)
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ–º–µ–Ω

### 3. **Production deployment**
–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å process manager (systemd, supervisord)
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ñ–∞–π–ª—ã
- –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Sentry, Prometheus)
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î

---

## üîó –ü–û–õ–ï–ó–ù–´–ï –°–°–´–õ–ö–ò

- [OpenRouter API Documentation](https://openrouter.ai/docs)
- [Gemini 2.5 Flash Image Preview](https://openrouter.ai/google/gemini-2.5-flash-image-preview)
- [Robokassa API](https://docs.robokassa.ru/)
- [aiogram 3 Documentation](https://docs.aiogram.dev/)

---

## üìû –ü–û–î–î–ï–†–ñ–ö–ê

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ webhook —Å–µ—Ä–≤–µ—Ä–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å API –∫–ª—é—á–µ–π
4. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Robokassa

---

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞**: 2025-11-10
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É**: üü° –¢—Ä–µ–±—É–µ—Ç—Å—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ OpenRouter API
